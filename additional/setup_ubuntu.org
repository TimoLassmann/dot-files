#+TITLE:  Common commands to install missing packages 
#+AUTHOR: Timo Lassmann
#+EMAIL:  timo.lassmann@telethonkids.org.au
#+DATE:   2019-01-16
#+LATEX_CLASS: report
#+OPTIONS:  toc:nil
#+OPTIONS: H:4
#+LATEX_CMD: pdflatex
* Introduction 
  Essentials: 
  #+BEGIN_SRC bash 


    sudo add-apt-repository universe
    sudo apt update
    sudo apt upgrade -y
    sudo apt  install zsh autoconf libtool make cmake git screen zsh r-base libboost-all-dev nfs-common nfs-kernel-server gdebi-core libpoppler-dev libpoppler-glib-dev libpoppler-private-dev xrdp valgrind exuberant-ctags global



  #+END_SRC

Desktop... 

#+BEGIN_SRC bash 
sudo apt install ubuntu-desktop

#+END_SRC
(maybe a reboot is necessary) 
  R-studio 
  #+BEGIN_SRC bash 
    wget https://download1.rstudio.org/desktop/bionic/amd64/rstudio-1.2.1335-amd64.deb
    sudo gdebi rstudio-1.2.1335-amd64.deb
  #+END_SRC

* Add users 

  #+NAME: users 
  #+BEGIN_SRC bash 
    users=(alexia richard denise genevieve vanessa catherine sarra jenefer melvin)
  #+END_SRC


  #+BEGIN_SRC bash -n :tangle add_user.sh :shebang #!/usr/bin/env bash :noweb yes
    DIR=`pwd`
    USERNAME=
    PASSWORD="password"
    function usage()
    {

        printf "This script will add users to a linux system.\n\n" ;
        printf "The default password is password and needs to be changed by the user.\n\n";
        printf "usage: $0 -n <user name> \n\n" ;
        exit 1;
    }

    while getopts n:  opt
    do

        case ${opt} in
            n) USERNAME=${OPTARG};;
            ,*) usage;;
        esac
    done
    if [ "${USERNAME}" == "" ]; then usage; fi

    echo "Creating user $USERNAME"

    sudo useradd  -b /data/workspace/ -g analysis -m $USERNAME
    
    echo "$USERNAME:password" | sudo chpasswd


    #+END_SRC

  #+BEGIN_SRC bash -n :tangle add_all_users.sh :shebang #!/usr/bin/env bash :noweb yes
    <<users>>

    echo "Current number of users: ${#users[*]}"

    echo "Users:"
    for item in ${users[*]}
    do
        printf "\t%s\n" $item
        ./add_user.sh -n $item
    done


  #+END_SRC  
  Create group analysis and add users 
  #+BEGIN_SRC bash 
sudo addgroup analysis
    ./add_all_users.sh
  #+END_SRC

* mounting NFS volumes 

  Create mount points 

  #+BEGIN_SRC bash 

    sudo mkdir -p /data/raw 
    sudo mkdir -p /data/workspace 
    sudo chown -R root:analysis /data
  #+END_SRC

  Mount the shares :
  #+BEGIN_SRC bash
    sudo mount -t nfs -o noatime,vers=3,proto=tcp,rsize=1048576,wsize=1048576,timeo=10000,hard,intr,nolock honas03-tkiprod01.ichr.uwa.edu.au:/HOGRD01_RAWData /data/raw 
    sudo mount -t nfs -o noatime,vers=3,proto=tcp,rsize=1048576,wsize=1048576,timeo=10000,hard,intr,nolock honas03-tkiprod01.ichr.uwa.edu.au:/HOGRD01_WorkSpace /data/workspace
  #+END_SRC

  Unmount:

  #+BEGIN_SRC bash
    sudo umount /data/raw 
    sudo umount /data/workspace 
  #+END_SRC

  To automatically mount disks when booting the machine add these lines to fstab: 

* Fix X2GO

To get rstudio to work with x2go(note that is works via ssh -X <server> rstudio  and the server / browser version)

edit:

#+BEGIN_EXAMPLE bash 
sudo emacs /etc/x2go/x2goagent.options
#+END_EXAMPLE

and un-comment this line: 

X2GO_NXAGENT_DEFAULT_OPTIONS+=" -extension GLX" 






* Install new(er) R version 

#+BEGIN_SRC bash 
sudo apt install apt-transport-https software-properties-common
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
sudo add-apt-repository 'deb https://cloud.r-project.org/bin/linux/ubuntu bionic-cran35/'
sudo apt update
sudo apt install r-base

#+END_SRC
